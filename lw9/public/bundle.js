(()=>{"use strict";var e,t,n={221:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=void 0;var o=n(147),i=function(){function e(){this.m_elementHTML=document.createElement("div"),this.m_width=640,this.m_height=480,this.onCanvasClick=new o.Signal}return e.prototype.getOnCanvasClick=function(){return this.onCanvasClick},e.prototype.getDomElement=function(){return this.m_elementHTML},e.prototype.getWidth=function(){return this.m_width},e.prototype.getHeight=function(){return this.m_height},e.prototype.render=function(e){var t=this;this.m_elementHTML.innerHTML="",this.m_elementHTML.classList.add("canvas"),this.m_elementHTML.style.width="".concat(this.m_width,"px"),this.m_elementHTML.style.height="".concat(this.m_height,"px"),this.m_elementHTML.onmousedown=function(e){e.defaultPrevented||t.onCanvasClick.dispatch()},e.appendChild(this.m_elementHTML)},e}();t.Canvas=i},977:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeFactory=void 0;var o=n(450),i=n(704),r=n(138),a=n(891),l=function(){function e(){}return e.createShapeModel=function(e,t){var n=t.getWidth(),i=t.getHeight();return new o.Shape(100,70,i/2-35,n/2-50,e)},e.createShapeRenderer=function(e,t){switch(e.shapeType){case"rectangle":return new i.RectangleRenderer(e,t);case"ellipse":return new r.EllipseRenderer(e,t);case"triangle":return new a.TriangleRenderer(e,t)}},e}();t.ShapeFactory=l},147:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Signal=t.ISignal=void 0;t.ISignal=function(){};var n=function(){function e(){this.m_listeners=[]}return e.prototype.add=function(e){var t=this;return this.m_listeners.push(e),function(){var n=t.m_listeners.indexOf(e);n>=0&&t.m_listeners.splice(n,1)}},e.prototype.addCallOnce=function(e){var t=this.add((function(n){e(n),t()}))},e.prototype.dispatch=function(e){for(var t=0,n=this.m_listeners;t<n.length;t++)(0,n[t])(e)},e.prototype.clearListeners=function(){this.m_listeners=[]},e}();t.Signal=n},452:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonRenderer=void 0;var o=n(147),i=function(){function e(e,t){var n=this;this.buttonHTML=document.createElement("button"),this.onClickSignal=new o.Signal,this.m_text=e,t.forEach((function(e){return n.buttonHTML.classList.add(e)}))}return e.prototype.getOnClickSignal=function(){return this.onClickSignal},e.prototype.render=function(e){var t=this;this.buttonHTML.innerHTML=this.m_text,this.buttonHTML.onclick=function(){return t.onClickSignal.dispatch()},e.appendChild(this.buttonHTML)},e}();t.ButtonRenderer=i},81:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateUid=void 0,t.generateUid=function(){for(var e="",t=0;t++<36;){var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[t-1],o=16*Math.random()|0;e+="-"==n||"4"==n?n:("x"==n?o:3&o|8).toString(16)}return e}},234:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EditorController=void 0;var n=function(){function e(e,t){this.m_model=e,this.m_renderer=t}return e.prototype.addShape=function(e){this.m_model.addShape(e)},e.prototype.removeSelectedShape=function(){this.m_model.removeSelectedShape()},e.prototype.setSelectedShape=function(e){this.m_model.setSelectedShape(e)},e}();t.EditorController=n},825:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EditorModel=void 0;var o=n(147),i=function(){function e(){this.m_shapes=[],this.m_selectedShape=null,this.m_onSelectedShapeChanged=new o.Signal,this.m_onShapeCreated=new o.Signal,this.m_onShapeRemoved=new o.Signal}return e.prototype.getOnShapeCreated=function(){return this.m_onShapeCreated},e.prototype.getOnShapeRemoved=function(){return this.m_onShapeRemoved},e.prototype.getOnSelectedShapeChanged=function(){return this.m_onSelectedShapeChanged},e.prototype.getSelectedShape=function(){return this.m_selectedShape},e.prototype.getShapes=function(){return this.m_shapes},e.prototype.setSelectedShape=function(e){if(e!==this.m_selectedShape){if(this.m_selectedShape=e,e){var t=this.m_shapes.find((function(t){return t.id===e}));t&&(this.m_shapes=this.m_shapes.filter((function(t){return t.id!==e})),this.m_shapes.push(t))}this.m_onSelectedShapeChanged.dispatch()}},e.prototype.addShape=function(e){this.m_shapes.push(e),this.m_onShapeCreated.dispatch(e)},e.prototype.removeSelectedShape=function(){var e=this;if(this.m_selectedShape){this.m_shapes=this.m_shapes.filter((function(t){return e.m_selectedShape!==t.id}));var t=this.m_selectedShape;this.m_selectedShape=null,this.m_onShapeRemoved.dispatch(t)}},e}();t.EditorModel=i},950:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EditorRenderer=void 0;var o=n(221),i=n(570),r=n(977),a=n(234),l=function(){function e(e){var t=this;this.m_shapeIdToRendererMap=new Map,this.editorHTML=document.createElement("div"),this.m_model=e,this.m_controller=new a.EditorController(e,this),this.m_model.getOnShapeCreated().add((function(e){var n=r.ShapeFactory.createShapeRenderer(e,t.m_canvas);n.getOnSelectSignal().add((function(){return t.m_controller.setSelectedShape(e.id)})),t.m_shapeIdToRendererMap.set(e.id,n),t.render()})),this.m_model.getOnShapeRemoved().add((function(e){t.m_shapeIdToRendererMap.delete(e),t.render()})),this.m_model.getOnSelectedShapeChanged().add((function(){return t.render()})),this.m_canvas=new o.Canvas,this.m_canvas.getOnCanvasClick().add((function(){return t.m_controller.setSelectedShape(null)})),this.m_toolbarRenderer=new i.ToolbarRenderer,this.m_toolbarRenderer.getOnCreateShapeSignal().add((function(e){t.addShape(r.ShapeFactory.createShapeModel(e,t.m_canvas))})),this.m_toolbarRenderer.getOnDeleteShapeSignal().add((function(){return t.removeShape()})),window.onkeydown=function(e){"Delete"===e.key&&t.removeShape()}}return e.prototype.addShape=function(e){this.m_controller.addShape(e)},e.prototype.removeShape=function(){this.m_controller.removeSelectedShape()},e.prototype.render=function(){var e=this;this.editorHTML.innerHTML="",this.editorHTML.classList.add("main-container"),this.m_toolbarRenderer.render(this.editorHTML);var t=document.createElement("div");t.classList.add("workspace"),this.m_canvas.render(t),this.editorHTML.appendChild(t),document.body.appendChild(this.editorHTML),this.m_model.getShapes().forEach((function(t){var n=t.id,o=e.m_shapeIdToRendererMap.get(n);o&&(o.setSelected(n===e.m_model.getSelectedShape()),o.render())}))},e}();t.EditorRenderer=l},570:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToolbarRenderer=void 0;var o=n(147),i=n(452),r=function(){function e(){var e=this;this.toolbarHTML=document.createElement("div"),this.onCreateShapeSignal=new o.Signal,this.onDeleteShapeSignal=new o.Signal,this.m_createRectangleButton=new i.ButtonRenderer("Rect",["button"]),this.m_createRectangleButton.getOnClickSignal().add((function(){return e.onCreateShapeSignal.dispatch("rectangle")})),this.m_createTriangleButton=new i.ButtonRenderer("Triangle",["button"]),this.m_createTriangleButton.getOnClickSignal().add((function(){return e.onCreateShapeSignal.dispatch("triangle")})),this.m_createEllipseButton=new i.ButtonRenderer("Ellipse",["button"]),this.m_createEllipseButton.getOnClickSignal().add((function(){return e.onCreateShapeSignal.dispatch("ellipse")})),this.m_onDeleteShapeButton=new i.ButtonRenderer("Delete",["button"]),this.m_onDeleteShapeButton.getOnClickSignal().add((function(){return e.onDeleteShapeSignal.dispatch()}))}return e.prototype.getOnCreateShapeSignal=function(){return this.onCreateShapeSignal},e.prototype.getOnDeleteShapeSignal=function(){return this.onDeleteShapeSignal},e.prototype.render=function(e){this.toolbarHTML.innerHTML="",this.toolbarHTML.classList.add("toolbar"),this.m_createRectangleButton.render(this.toolbarHTML),this.m_createEllipseButton.render(this.toolbarHTML),this.m_createTriangleButton.render(this.toolbarHTML),this.m_onDeleteShapeButton.render(this.toolbarHTML),e.appendChild(this.toolbarHTML)},e}();t.ToolbarRenderer=r},961:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DragNDropHandler=void 0;var o=n(147),i=function(){function e(e){var t=this;this.onMoveSignal=new o.Signal,this.onDragStart=new o.Signal,this.m_element=e,this.m_element.onmousedown=function(e){e.defaultPrevented||(e.preventDefault(),t.onDragStart.dispatch(),t.onShapeMouseDown(e))}}return e.prototype.getOnDragStart=function(){return this.onDragStart},e.prototype.getOnMoveSignal=function(){return this.onMoveSignal},e.prototype.onShapeMouseUp=function(){window.onmousemove=null,window.onmouseup=null},e.prototype.onShapeMove=function(e,t,n){this.onMoveSignal.dispatch({left:e.x-t,top:e.y-n})},e.prototype.onShapeMouseDown=function(e){var t=this,n=this.m_element.getBoundingClientRect(),o=e.x-n.left,i=e.y-n.top;window.onmousemove=function(e){return t.onShapeMove(e,o,i)},window.onmouseup=function(){return t.onShapeMouseUp()}},e}();t.DragNDropHandler=i},955:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResizeHandler=void 0;var o=n(147),i=function(){function e(e){this.onRectChangeSignal=new o.Signal,this.m_element=e,this.addResizeHandlers()}return e.prototype.getOnRectChangeSignal=function(){return this.onRectChangeSignal},e.prototype.customizeControllers=function(e,t){e.style.width="".concat(10,"px"),e.style.height="".concat(10,"px"),e.style.position="absolute",e.style.background="blue";var n="-".concat(5,"px");"leftBottom"===t?(e.style.bottom=n,e.style.left=n):"leftTop"===t?(e.style.top=n,e.style.left=n):"rightBottom"===t?(e.style.bottom=n,e.style.right=n):"rightTop"===t&&(e.style.top=n,e.style.right=n),this.subscribeOnDnd(e,t)},e.prototype.handleMouseUp=function(){window.onmousemove=null,window.onmouseup=null},e.prototype.handlerMouseMove=function(e,t){var n=e.clientX,o=e.clientY,i=this.m_element.getBoundingClientRect();"leftTop"===t?this.onRectChangeSignal.dispatch({left:n,top:o,width:i.right-n,height:i.bottom-o}):"rightTop"===t?this.onRectChangeSignal.dispatch({left:i.left,top:o,width:n-i.left,height:i.bottom-o}):"leftBottom"===t?this.onRectChangeSignal.dispatch({left:n,top:i.top,width:i.right-n,height:o-i.top}):"rightBottom"===t&&this.onRectChangeSignal.dispatch({left:i.left,top:i.top,width:n-i.left,height:o-i.top})},e.prototype.subscribeOnDnd=function(e,t){var n=this;e.onmousedown=function(e){e.preventDefault(),window.onmousemove=function(e){return n.handlerMouseMove(e,t)},window.onmouseup=function(){return n.handleMouseUp()}}},e.prototype.addResizeHandlers=function(){var e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div");this.customizeControllers(e,"leftTop"),this.customizeControllers(t,"rightTop"),this.customizeControllers(n,"leftBottom"),this.customizeControllers(o,"rightBottom"),this.m_element.appendChild(e),this.m_element.appendChild(t),this.m_element.appendChild(n),this.m_element.appendChild(o)},e}();t.ResizeHandler=i},138:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EllipseRenderer=void 0;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getShapeHtmlImpl=function(){var e=this.model,t=e.width,n=e.height;return"<svg\n            xmlns='http://www.w3.org/2000/svg'\n            width='".concat(t,"'\n            height='").concat(n,"'\n            viewPort='0 0 ").concat(t," ").concat(n,"'>\"\n            <ellipse rx='").concat(t/2,"' ry='").concat(n/2,"' cx='").concat(t/2,"' cy='").concat(n/2,'\' fill="green" />\n        </svg>')},t}(n(646).ShapeRenderer);t.EllipseRenderer=r},704:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RectangleRenderer=void 0;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getShapeHtmlImpl=function(){var e=this.model,t=e.width,n=e.height;return"<svg\n            xmlns='http://www.w3.org/2000/svg'\n            width='".concat(t,"'\n            height='").concat(n,"'\n            viewPort='0 0 ").concat(t," ").concat(n,"'>\"\n            <polygon points='").concat(0,",").concat(0," ").concat(t,",").concat(0," ").concat(t,",").concat(n," ").concat(0,",").concat(n,"' fill='black' />\n        </svg>")},t}(n(646).ShapeRenderer);t.RectangleRenderer=r},450:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=void 0;var o=n(147),i=n(81),r=function(){function e(e,t,n,r,a){this.onRectChange=new o.Signal,this.onSelectedChange=new o.Signal,this.m_width=e,this.m_height=t,this.m_left=r,this.m_top=n,this.m_shapeType=a,this.m_id=(0,i.generateUid)(),this.m_isSelected=!1}return e.prototype.getOnRectChange=function(){return this.onRectChange},e.prototype.getOnSelectedChange=function(){return this.onSelectedChange},Object.defineProperty(e.prototype,"id",{get:function(){return this.m_id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shapeType",{get:function(){return this.m_shapeType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.m_width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.m_height},enumerable:!1,configurable:!0}),e.prototype.setRect=function(e,t,n,o){this.m_top=t,this.m_left=e,this.m_width=n,this.m_height=o,this.onRectChange.dispatch()},e.prototype.setSelected=function(e){this.m_isSelected=e,this.onSelectedChange.dispatch()},Object.defineProperty(e.prototype,"isSelected",{get:function(){return this.m_isSelected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.m_left},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.m_top},enumerable:!1,configurable:!0}),e}();t.Shape=r},954:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeController=void 0;var n=function(){function e(e,t){this.m_model=e,this.m_view=t}return e.prototype.setRect=function(e,t,n,o){this.m_model.setRect(e,t,n,o)},e.prototype.setPosition=function(e,t){this.m_model.setRect(e,t,this.m_model.width,this.m_model.height)},e.prototype.setSize=function(e,t){this.m_model.setRect(this.m_model.left,this.m_model.top,e,t)},e.prototype.setIsSelected=function(e){this.m_model.setSelected(e)},e}();t.ShapeController=n},646:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeRenderer=void 0;var o=n(954),i=n(961),r=n(955),a=n(147),l=function(){function e(e,t){var n=this;this.m_element=document.createElement("div"),this.onSelectSignal=new a.Signal,this.m_model=e,this.m_canvas=t,this.m_controller=new o.ShapeController(e,this),this.m_model.getOnRectChange().add((function(){return n.rerender()}))}return e.prototype.getOnSelectSignal=function(){return this.onSelectSignal},Object.defineProperty(e.prototype,"model",{get:function(){return this.m_model},enumerable:!1,configurable:!0}),e.prototype.setSelected=function(e){this.m_controller.setIsSelected(e)},e.prototype.rerender=function(){var e=this.m_model.left,t=this.m_model.top,n=this.m_model.width,o=this.m_model.height;this.m_element.style.left="".concat(e,"px"),this.m_element.style.top="".concat(t,"px"),this.m_element.style.width="".concat(n,"px"),this.m_element.style.height="".concat(o,"px"),this.m_element.style.position="absolute",this.m_element.style.boxShadow=this.m_model.isSelected?"0 0 0 2px blue":"";var i=this.m_element.getElementsByTagName("svg")[0];i?i.outerHTML=this.getShapeHtmlImpl():this.m_element.innerHTML=this.getShapeHtmlImpl()},e.prototype.handleMove=function(e,t){var n=t.getBoundingClientRect(),o=e.left,i=e.top,r=this.m_model.width,a=this.m_model.height;this.m_controller.setRect(Math.min(Math.max(o-n.left,0),n.right-n.left-r),Math.min(Math.max(i-n.top,0),n.bottom-n.top-a),r,a)},e.prototype.handleResize=function(e,t){var n=t.getBoundingClientRect(),o=Math.max(e.left,n.left),i=Math.max(e.top,n.top),r=Math.min(e.left+e.width,n.right),a=Math.min(e.top+e.height,n.bottom);this.m_controller.setRect(o-n.left,i-n.top,Math.max(r-o,20),Math.max(a-i,20))},e.prototype.render=function(){var e=this;this.m_element.innerHTML="",this.rerender();var t=this.m_canvas.getDomElement();this.m_model.isSelected&&new r.ResizeHandler(this.m_element).getOnRectChangeSignal().add((function(n){return e.handleResize(n,t)}));var n=new i.DragNDropHandler(this.m_element);n.getOnMoveSignal().add((function(n){return e.handleMove(n,t)})),n.getOnDragStart().add((function(){return e.onSelectSignal.dispatch()})),t.appendChild(this.m_element)},e}();t.ShapeRenderer=l},891:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.TriangleRenderer=void 0;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getShapeHtmlImpl=function(){var e=this.model,t=e.width,n=e.height;return"<svg\n            xmlns='http://www.w3.org/2000/svg'\n            width='100%'\n            height='100%'\n            viewPort='0 0 ".concat(t," ").concat(n,"'>\"\n            <polygon points='").concat(0,",").concat(n," ").concat(t,",").concat(n," ").concat(t/2,",").concat(0,"' fill='yellow' />\n        </svg>")},t}(n(646).ShapeRenderer);t.TriangleRenderer=r}},o={};function i(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return n[e].call(r.exports,r,r.exports,i),r.exports}e=i(825),t=i(950),window.onload=function(){var n;n=new e.EditorModel,new t.EditorRenderer(n).render()}})();